<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>S</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
